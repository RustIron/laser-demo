# 激光二极管测试设备仿真环境 - 项目需求文档

## 📋 项目概述

### 项目名称
**Laser Diode Test Equipment Simulation Environment**
（激光二极管测试设备仿真环境）

### 项目目标
创建一个基于Python的高精度激光二极管测试自动化设备仿真环境，包含：
- 6轴平台用于芯片精确定位
- 3轴龙门用于芯片装载
- 3轴探针平台带按压/释放功能
- PyQt5/6 GUI界面
- 基于JSON的命令配置
- 实时可视化和状态监控

---

## 🎯 功能需求

### 1. 运动控制系统

#### 1.1 六轴定位平台
**需求描述**：实现包含X、Y、Z平移和Rx、Ry、Rz旋转的6自由度平台

**详细要求**：
- **平移范围**：X、Y轴±50mm，Z轴±10mm
- **旋转范围**：Rx、Ry轴±180°，Rz轴±360°
- **定位精度**：0.1微米
- **最大速度**：100mm/s（平移）、360°/s（旋转）
- **最大加速度**：500mm/s²（平移）、1800°/s²（旋转）

**技术规格**：
```
X轴: -50,000 ~ +50,000 μm, 速度 100,000 μm/s
Y轴: -50,000 ~ +50,000 μm, 速度 100,000 μm/s
Z轴: -10,000 ~ +10,000 μm, 速度 50,000 μm/s
Rx: -180° ~ +180°, 速度 360°/s
Ry: -180° ~ +180°, 速度 360°/s
Rz: -360° ~ +360°, 速度 720°/s
```

#### 1.2 三轴龙门系统
**需求描述**：用于芯片装载的三轴传送系统

**详细要求**：
- **平移范围**：X、Y轴±100mm，Z轴-5mm~+50mm
- **装卸功能**：芯片抓取和释放
- **装载速度**：200mm/s（比定位平台更快）
- **运动精度**：0.5微米

**技术规格**：
```
X轴: -100,000 ~ +100,000 μm, 速度 200,000 μm/s
Y轴: -100,000 ~ +100,000 μm, 速度 200,000 μm/s
Z轴: -5,000 ~ +50,000 μm, 速度 100,000 μm/s
```

#### 1.3 探针平台
**需求描述**：三轴探针系统，支持按压和释放操作

**详细要求**：
- **平移范围**：X、Y轴±20mm，Z轴±10mm
- **探针高度**：5mm
- **力控制**：最大力限制和实时监测
- **按压精度**：0.01微米（最高精度）

**技术规格**：
```
X轴: -20,000 ~ +20,000 μm, 速度 50,000 μm/s
Y轴: -20,000 ~ +20,000 μm, 速度 50,000 μm/s
Z轴: -10,000 ~ +10,000 μm, 速度 20,000 μm/s
力控制: 0 ~ 1000 力单位
```

### 2. 运动控制算法

#### 2.1 S型曲线轨迹规划
**需求描述**：实现平滑的S型运动轨迹，避免冲击和振动

**技术要求**：
- **7段式轨迹**：加加速度、恒定加速度、减加速度、匀速、...
- **突跳度限制**：10,000mm/s³
- **平滑过渡**：速度和加速度连续变化
- **路径优化**：最短时间运动

#### 2.2 实时运动控制
**需求描述**：1kHz频率的实时位置更新

**技术要求**：
- **更新频率**：1000Hz
- **位置插值**：基于时间的精确插值
- **状态监控**：实时位置、速度、加速度
- **运动完成检测**：位置容差检查

### 3. 安全系统

#### 3.1 碰撞检测
**需求描述**：实时的设备间碰撞检测和预防

**详细要求**：
- **实时检测**：1kHz频率碰撞检查
- **预测检测**：2秒提前预测
- **最小间隙**：1mm安全距离
- **安全区域**：定义禁区和允许区域
- **紧急停止**：碰撞时立即停止

**安全区域定义**：
```
芯片装载区：仅龙门系统可进入
探针操作区：六轴平台和探针平台可进入
全局安全区：1mm最小间隙要求
```

#### 3.2 力限制保护
**需求描述**：探针操作时的力监测和保护

**技术要求**：
- **力传感器模拟**：弹簧模型力计算
- **力阈值设置**：用户可配置力限制
- **停止条件**：超限立即停止
- **力显示**：实时力值显示

### 4. GUI用户界面

#### 4.1 主窗口布局
**需求描述**：三栏式专业控制界面

**布局要求**：
```
左侧面板 (30%)：
├── 阶段控制（标签页）
│   ├── 6轴控制
│   ├── 龙门控制
│   └── 探针控制
├── 紧急停止按钮（红色）
└── 复位按钮

中间面板 (40%)：
├── 3D可视化区域
├── 相机控制
├── 显示选项
└── 位置信息显示

右侧面板 (30%)：
├── 系统状态面板
├── 命令编辑器
├── 命令历史
└── 系统日志
```

#### 4.2 3D可视化
**需求描述**：实时3D场景显示

**功能要求**：
- **实时渲染**：20FPS更新率
- **阶段模型**：3D表示各运动平台
- **位置轨迹**：历史路径显示
- **碰撞警告**：3D碰撞可视化
- **相机控制**：缩放、旋转、平移
- **背景网格**：参考坐标系

**视觉元素**：
- 六轴平台：蓝色半透明立方体
- 龙门系统：绿色半透明立方体
- 探针平台：红色半透明立方体
- 警告标记：彩色球体（按严重程度）
- 安全区域：半透明边界框

#### 4.3 控制面板
**需求描述**：各阶段的独立控制界面

**通用控制功能**：
- **当前位置显示**：X、Y、Z、Rx、Ry、Rz
- **目标位置输入**：数值输入框
- **运动参数设置**：速度、加速度
- **动作按钮**：移动、回零、停止

**特殊功能**：
- **探针控制**：按压/释放、目标Z、力限制
- **龙门控制**：芯片装载/卸载状态

### 5. 命令系统

#### 5.1 JSON命令格式
**需求描述**：专业级Modbus风格的命令接口

**命令结构**：
```json
{
  "command_id": "ST0001",
  "command_type": "MOVE",
  "target_stage": "six_axis",
  "parameters": {
    "position": {
      "position": {
        "x": 10500,
        "y": 5200,
        "z": 100,
        "rotation": {
          "rx": 0.0,
          "ry": 0.0,
          "rz": 45.0
        }
      },
      "velocity": 50000,
      "acceleration": 500000
    },
    "execution": {
      "mode": "immediate",
      "priority": 5,
      "timeout": 30.0
    }
  }
}
```

#### 5.2 命令类型
**需求描述**：支持完整的设备操作指令

**命令列表**：
- `MOVE` - 移动到目标位置
- `HOME` - 回零操作（指定或全部阶段）
- `PRESS_PROBE` - 按压探针（目标Z、力限制）
- `RETRACT_PROBE` - 收回探针
- `LOAD_CHIP` - 装载芯片（源位置、目标位置）
- `UNLOAD_CHIP` - 卸载芯片
- `GET_STATUS` - 获取系统状态
- `GET_POSITION` - 获取位置信息
- `EMERGENCY_STOP` - 紧急停止
- `RESET_EMERGENCY_STOP` - 复位紧急停止

#### 5.3 命令处理
**需求描述**：队列管理和执行控制

**功能要求**：
- **执行模式**：立即执行或队列排队
- **优先级队列**：1-10优先级支持
- **命令验证**：JSON Schema验证
- **执行跟踪**：状态、结果、错误日志
- **超时处理**：可配置命令超时

---

## 📊 性能需求

### 1. 实时性能
- **更新频率**：1kHz运动控制
- **GUI响应**：<50ms交互延迟
- **可视化帧率**：20FPS 3D渲染
- **命令延迟**：<100ms命令处理

### 2. 精度要求
- **位置精度**：0.1微米分辨率
- **运动稳定性**：速度波动<1%
- **重复精度**：±0.5微米
- **角度精度**：0.001度

### 3. 资源使用
- **内存占用**：<500MB全系统运行
- **CPU使用**：<50%单核心
- **启动时间**：<3秒初始化
- **磁盘占用**：<200MB安装空间

---

## 🛠️ 技术需求

### 1. 开发环境
- **Python版本**：3.8+
- **GUI框架**：PyQt5/6
- **3D渲染**：PyOpenGL或PyVista
- **数值计算**：NumPy
- **JSON处理**：内置json + jsonschema

### 2. 平台支持
- **操作系统**：Windows 10、macOS 10.14、Ubuntu 18.04
- **显示要求**：OpenGL 3.3支持
- **硬件要求**：4GB RAM、集成显卡支持

### 3. 代码质量
- **代码规范**：PEP 8标准
- **文档覆盖**：完整函数文档
- **单元测试**：>90%代码覆盖率
- **错误处理**：完善的异常处理机制

---

## 🔒 安全需求

### 1. 运动安全
- **速度限制**：各轴独立速度限制
- **加速度限制**：防止过载的加速度控制
- **位置限制**：软硬件双层位置保护
- **紧急停止**：硬件和软件紧急停止

### 2. 操作安全
- **碰撞预防**：预测性碰撞检测
- **权限管理**：操作权限分级
- **操作日志**：完整操作记录
- **恢复机制**：故障后安全恢复

### 3. 数据安全
- **配置备份**：自动配置备份
- **版本控制**：配置版本管理
- **数据完整性**：校验和验证
- **隐私保护**：敏感数据加密

---

## 📈 扩展需求

### 1. 模块化设计
- **插件架构**：支持功能模块扩展
- **接口标准化**：统一的API接口
- **配置灵活**：参数配置灵活调整
- **脚本支持**：Python脚本自动化

### 2. 网络功能
- **远程控制**：网络命令接口
- **状态监控**：远程状态查询
- **数据上传**：测量数据上传
- **系统更新**：在线更新功能

### 3. 高级功能
- **机器学习**：智能路径优化
- **预测维护**：设备健康监测
- **数据分析**：测试数据分析
- **报告生成**：自动报告生成

---

## 📝 文档需求

### 1. 用户文档
- **操作手册**：详细操作指南
- **快速入门**：新用户引导
- **API文档**：命令接口说明
- **故障排除**：常见问题解决

### 2. 开发文档
- **架构设计**：系统架构说明
- **代码文档**：代码详细注释
- **接口文档**：模块接口定义
- **测试文档**：测试用例说明

### 3. 维护文档
- **部署指南**：系统部署说明
- **配置说明**：参数配置指南
- **维护手册**：日常维护操作
- **升级指南**：版本升级流程

---

**文档版本**：1.0
**创建日期**：2026年1月20日
**最后更新**：2026年1月20日
**文档状态**：已完成需求分析，进入实施阶段